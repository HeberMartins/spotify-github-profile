<svg width="460" height="152" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-labelledby="cardTitle" role="img">
  <title id="cardTitle">Now playing on Spotify</title>
  <foreignObject width="460" height="152">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      .spotify-embed-container {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        {% if mode == 'dark' %}
        background-color: #181818;
        {% else %}
        background-color: #ffffff;
        {% endif %}
        border-radius: 8px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 16px;
        width: 460px;
        height: 152px;
        position: relative;
      }

      .album-cover-container {
        flex-shrink: 0;
        width: 120px;
        height: 120px;
        border-radius: 4px;
        overflow: hidden;
        {% if mode == 'dark' %}
        background-color: #282828;
        {% else %}
        background-color: #f0f0f0;
        {% endif %}
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .album-cover {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .track-info-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-width: 0;
        height: 120px;
      }

      .track-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .track-name {
        {% if mode == 'dark' %}
        color: #ffffff;
        {% else %}
        color: #000000;
        {% endif %}
        font-size: 18px;
        font-weight: 700;
        line-height: 24px;
        margin-bottom: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .artist-name {
        {% if mode == 'dark' %}
        color: #b3b3b3;
        {% else %}
        color: #6a6a6a;
        {% endif %}
        font-size: 14px;
        font-weight: 400;
        line-height: 20px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .spotify-logo-container {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 8px;
      }

      .spotify-logo {
        width: 20px;
        height: 20px;
      }

      .status-text {
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        {% if is_now_playing %}
        color: #1db954;
        {% else %}
        color: #b3b3b3;
        {% endif %}
      }

      .progress-container {
        width: 100%;
        margin-top: auto;
      }

      .progress-bar-bg {
        width: 100%;
        height: 4px;
        {% if mode == 'dark' %}
        background-color: #404040;
        {% else %}
        background-color: #d9dadc;
        {% endif %}
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 6px;
      }

      .progress-bar-fill {
        height: 100%;
        {% if is_now_playing %}
        background-color: #1db954;
        {% else %}
        {% if mode == 'dark' %}
        background-color: #535353;
        {% else %}
        background-color: #949494;
        {% endif %}
        {% endif %}
        border-radius: 2px;
        transition: width 1s linear;
      }

      .progress-times {
        display: flex;
        justify-content: space-between;
        {% if mode == 'dark' %}
        color: #a7a7a7;
        {% else %}
        color: #6a6a6a;
        {% endif %}
        font-size: 11px;
        font-weight: 400;
      }

      .offline-placeholder {
        {% if mode == 'dark' %}
        color: #b3b3b3;
        {% else %}
        color: #6a6a6a;
        {% endif %}
        font-size: 14px;
        text-align: center;
      }

      /* Spotify Logo SVG color */
      .spotify-icon {
        fill: {% if mode == 'dark' %}#ffffff{% else %}#000000{% endif %};
      }
    </style>
    <div xmlns="http://www.w3.org/1999/xhtml" class="spotify-embed-container">
      {% if song_name %}
        <div class="album-cover-container">
          {% if cover_image and img %}
            <img class="album-cover" src="data:image/jpeg;base64,{{img}}" alt="Album Cover" />
          {% else %}
            <svg class="spotify-icon" width="48" height="48" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
            </svg>
          {% endif %}
        </div>
        <div class="track-info-container">
          <div class="track-details">
            <div class="track-name">{{song_name|safe}}</div>
            <div class="artist-name">{{artist_name|safe}}</div>
            <div class="spotify-logo-container">
              <svg class="spotify-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path fill="#1db954" d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
              </svg>
              <span class="status-text">{{ title_text }}</span>
            </div>
          </div>
          <div class="progress-container">
            <div class="progress-bar-bg">
              {% if progress_data %}
                <div class="progress-bar-fill" style="width: {{ progress_data.progress_percentage }}%"></div>
              {% else %}
                <div class="progress-bar-fill" style="width: 0%"></div>
              {% endif %}
            </div>
            <div class="progress-times">
              {% if progress_data %}
                <span>{{ progress_data.current_time }}</span>
                <span>{{ progress_data.remaining_time }}</span>
              {% else %}
                <span>0:00</span>
                <span>-{{song_name|length // 10}}:{{(song_name|length % 10) * 6}}</span>
              {% endif %}
            </div>
          </div>
        </div>
      {% else %}
        <div class="album-cover-container">
          <svg class="spotify-icon" width="48" height="48" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
          </svg>
        </div>
        <div class="track-info-container">
          <div class="offline-placeholder">Not currently playing on Spotify</div>
        </div>
      {% endif %}
    </div>
  </foreignObject>
</svg>
